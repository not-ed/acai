<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="AcaiMobile.FoodJournalPage"
             Title="Food Journal"

             xmlns:acaiMobile="clr-namespace:AcaiMobile"
             x:DataType="acaiMobile:FoodJournalViewModel"
             x:Name="FoodJournalViewModelRoot"
             >
    
    <CarouselView PositionChangedCommand="{Binding CarouselSwipeCommand}" PositionChangedCommandParameter="{Binding Source={RelativeSource Self}, Path=CurrentItem}">
        <CarouselView.ItemsSource>
            <x:Array Type="{x:Type x:Int32}">
                <x:Int32>0</x:Int32>
                <x:Int32>1</x:Int32>
                <x:Int32>3</x:Int32>
            </x:Array>
        </CarouselView.ItemsSource>
        <CarouselView.ItemTemplate>
            <DataTemplate>
                <Frame>
                    <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"></RowDefinition>
                        <RowDefinition Height="8*"></RowDefinition>
                        <RowDefinition Height=".75*"></RowDefinition>
                        <RowDefinition Height="1*"></RowDefinition>
                    </Grid.RowDefinitions>
                        
                        <Label Style="{StaticResource H1}" Margin="10" Grid.Row="0" Text="{Binding Source={Reference FoodJournalViewModelRoot}, Path=BindingContext.SelectedDate, StringFormat='{0:ddd d MMM yyyy}'}">
                            <Label.Behaviors>
                                <toolkit:TouchBehavior Command="{Binding Source={Reference FoodJournalViewModelRoot}, Path=BindingContext.DateTapCommand}"></toolkit:TouchBehavior>
                            </Label.Behaviors>
                        </Label>

                        <ScrollView Grid.Row="1">
                        <VerticalStackLayout
                            Spacing="5"
                            Padding="10,10">
                            <CollectionView ItemsSource="{Binding Source={Reference FoodJournalViewModelRoot}, Path=BindingContext.FoodItemsList}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="{x:Type acaiMobile:FoodJournalViewItem}">
                                        <Frame Margin="0,5" BindingContext="{Binding .}">
                                            <Frame.GestureRecognizers>
                                                <TapGestureRecognizer 
                                                   Command="{Binding Source={Reference FoodJournalViewModelRoot}, Path=BindingContext.DisplayItemActionsCommand}"
                                                   CommandParameter="{Binding .}"
                                                    />
                                            </Frame.GestureRecognizers>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="75*"/>
                                                    <ColumnDefinition Width="25*"/>
                                                </Grid.ColumnDefinitions>
                                                <Label Grid.Column="0" Text="{Binding Name}" HorizontalOptions="Start" FontAttributes="Bold" ></Label>
                                                <Label Grid.Column="1" Text="{Binding Calories, StringFormat=\{0\}kcal}" HorizontalOptions="End" VerticalTextAlignment="Center" LineBreakMode="CharacterWrap"></Label>
                                            </Grid>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </ScrollView>

                    <Label Grid.Row="2" Text="{Binding Source={Reference FoodJournalViewModelRoot}, Path=BindingContext.TotalCalories, StringFormat='Total: {0}kcal'}" HorizontalTextAlignment="Center" Margin="10" VerticalTextAlignment="Center"></Label>

                    <Button
                        Grid.Row="3"
                        Style="{StaticResource Main}"
                        Text="Add new Item"
                        Margin="10,0,10,10"
                        Command="{Binding Source={Reference FoodJournalViewModelRoot}, Path=BindingContext.AddFoodItemCommand}"/>
                </Grid>
                </Frame>
            </DataTemplate>
        </CarouselView.ItemTemplate>
    </CarouselView>
    
</ContentPage>
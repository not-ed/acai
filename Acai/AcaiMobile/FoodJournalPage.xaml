<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="AcaiMobile.FoodJournalPage"
             Title="Food Journal"

             xmlns:acaiMobile="clr-namespace:AcaiMobile"
             x:DataType="acaiMobile:FoodJournalViewModel"
             x:Name="FoodJournalViewModelRoot"
             >
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"></RowDefinition>
            <RowDefinition Height="8*"></RowDefinition>
            <RowDefinition Height=".75*"></RowDefinition>
            <RowDefinition Height="1*"></RowDefinition>
        </Grid.RowDefinitions>

        <Grid.GestureRecognizers>
            <SwipeGestureRecognizer Direction="Left" Threshold="50" Command="{Binding SwipeLeftCommand}"></SwipeGestureRecognizer>
            <SwipeGestureRecognizer Direction="Right" Threshold="50"  Command="{Binding SwipeRightCommand}"></SwipeGestureRecognizer>
        </Grid.GestureRecognizers>

        <Label Style="{StaticResource H1}" Margin="10" Grid.Row="0" Text="{Binding SelectedDate, StringFormat='{0:ddd d MMM yyyy}'}">
            <Label.Behaviors>
                <toolkit:TouchBehavior Command="{Binding DateTapCommand}"></toolkit:TouchBehavior>
            </Label.Behaviors>
        </Label>

            <ScrollView Grid.Row="1">
            <VerticalStackLayout
                Spacing="5"
                Padding="10,10">
                <CollectionView ItemsSource="{Binding FoodItemsList}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="{x:Type acaiMobile:FoodJournalViewItem}">
                            <Frame Margin="0,5" BindingContext="{Binding .}">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer 
                                       Command="{Binding Source={Reference FoodJournalViewModelRoot}, Path=BindingContext.ToggleItemExpansionCommand}"
                                       CommandParameter="{Binding .}"
                                        />
                                </Frame.GestureRecognizers>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="75*"/>
                                        <ColumnDefinition Width="25*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition></RowDefinition>
                                        <RowDefinition></RowDefinition>
                                    </Grid.RowDefinitions>
                                    <Label Grid.Column="0" Grid.Row="0" Text="{Binding Name}" HorizontalOptions="Start" FontAttributes="Bold" ></Label>
                                    <Label Grid.Column="1" Grid.Row="0" Text="{Binding Calories, StringFormat=\{0\}kcal}" HorizontalOptions="End" VerticalTextAlignment="Center" LineBreakMode="CharacterWrap"></Label>
                                    <Button Grid.Column="1" Grid.Row="1" 
                                            Style="{StaticResource Danger}"
                                            IsVisible="{Binding IsExpanded}" 
                                            Text="Delete" 
                                            HorizontalOptions="Center" 
                                            Margin="0,15,0,0"
                                            Command="{Binding Source={Reference FoodJournalViewModelRoot}, Path=BindingContext.PromptItemDeletionCommand}"
                                            CommandParameter="{Binding .}"></Button>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <Label Grid.Row="2" Text="{Binding TotalCalories, StringFormat='Total: {0}kcal'}" HorizontalTextAlignment="Center" Margin="10" VerticalTextAlignment="Center"></Label>

        <Button
            Grid.Row="3"
            Style="{StaticResource Main}"
            Text="Add new Item"
            Margin="10,0,10,10"
            Command="{Binding AddFoodItemCommand}"/>
    </Grid>
</ContentPage>